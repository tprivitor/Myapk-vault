
window.bxmlParser = {
  parseBytes: function(bytes) {
    const decoded = new TextDecoder().decode(bytes);
    if (!decoded.includes("manifest")) {
      return `<?xml version='1.0'?><manifest package='com.test.app' android:versionCode='123' android:versionName='9.9.9'><uses-permission android:name='android.permission.INTERNET' /></manifest>`;
    }
    return decoded;
  }
};
window.fxparser = {
  XMLParser: class {
    constructor(opts) { this.opts = opts; }
    parse(xml) {
      const parser = new DOMParser();
      const doc = parser.parseFromString(xml, "application/xml");
      const manifest = doc.documentElement;
      const versionCode = manifest.getAttribute("android:versionCode");
      const versionName = manifest.getAttribute("android:versionName");
      const packageName = manifest.getAttribute("package");
      const perms = Array.from(doc.getElementsByTagName("uses-permission")).map(
        p => ({ "@_android:name": p.getAttribute("android:name") })
      );
      return {
        manifest: {
          "@_android:versionCode": versionCode,
          "@_android:versionName": versionName,
          "@_package": packageName,
          "uses-permission": perms
        }
      };
    }
  }
};
